\RequirePackage{luatex85}
\documentclass{standalone}

% Default preamble
\usepackage{tikz}
\usepackage{pgfplots}
\pgfplotsset{compat=newest}
\usepgfplotslibrary{groupplots}
\usepgfplotslibrary{polar}
\usepgfplotslibrary{smithchart}
\usepgfplotslibrary{statistics}
\usepgfplotslibrary{dateplot}
\usepgfplotslibrary{ternary}

% Custom preamble from global variable:
\usetikzlibrary{patterns}
\usepackage{xcolor}
\definecolor{cred}{HTML}{ED1C24}
\definecolor{cgrey}{HTML}{7F7F7F}
\definecolor{cblue}{HTML}{00A2E8}
\definecolor{cgreen}{HTML}{22B14C}
\definecolor{cyellow}{HTML}{FFF200}
\definecolor{corange}{HTML}{EA7904}
\definecolor{cpurple}{HTML}{9100FC}
\definecolor{julia1}{HTML}{1F77B4}
\definecolor{julia2}{HTML}{FF7F0E}
\definecolor{julia3}{HTML}{2CA02C}
\definecolor{julia4}{HTML}{D62728}
\definecolor{julia5}{HTML}{9864BC}

\usepackage{caption}
\usepackage{subcaption}
\usepackage{amsmath}

\tikzset{
    pinnode/.style={draw=none, fill=none, outer sep=0.15, font=\tiny},
}

\renewcommand{\familydefault}{\sfdefault}

\begin{document}

    \begin{tikzpicture}
        \begin{groupplot}[%
            group style={%
                group name=myplot,
                group size= 2 by 3,
                vertical sep=75pt,
                horizontal sep=81.0pt,
            },
            height=7cm,width=7cm
        ]
        \nextgroupplot[%
            %title=type1,
            title=(a),
            title style = {text depth=0.15ex,xshift=-30ex},
            ymode=log,
            ybar = 0pt,
            xmajorgrids={false},
            ymajorgrids={false},
            xtick pos = bottom,
            ytick pos = left,
            bar width = 6pt,
            legend image code/.code={\draw [#1] (0cm,-0.1cm) rectangle (0.2cm,0.25cm);},
            legend style={%
                font=\tiny
            },
            xmin=0.3,
            xmax=5.7,
            ymin={1},
            ymax={10000000},
            ytick={1, 100, 10000, 1000000},
            xtick={1,2,3,4,5},
            xticklabels = {{E. coli core}, {iAB RBC 283}, {iIT341}, {iSB619}, {HepG2}},
            xticklabel style = {%
                rotate=45,
                anchor=north east
            },
            %ytick={0,25,50,75,100},
            ylabel={Carbon AEFM class count (\#)},
            axis line style={thick,black},
            xtick style={/pgfplots/on layer=axis foreground, thick, black},
            ytick style={/pgfplots/on layer=axis foreground, thick, black},
        ]
            \addplot[black, fill=julia1]
                coordinates {
                    (1,1095)
                    (2,5630)
                    (3,19795)
                    (4,39332)
                    (5,73320)
                }
                ;
            \addplot[black, fill=julia2]
                coordinates {
                    (1,4014)
                    (2,106)
                    (3,5432)
                    (4,11696)
                    (5,2098978)
                }
                ;
            \addplot[black, fill=julia3]
                coordinates {
                    (1,1149)
                    (2,2200)
                    (3,5370)
                    (4,8398)
                    (5,8089)
                }
                ;
            \addplot[black, fill=julia5]
                coordinates {
                    (1,261)
                    (2,22)
                    (3,36)
                    (4,18)
                    (5,226)
                }
                ;
            \coordinate (c1) at (rel axis cs:0,1);

        \nextgroupplot[%
            %title=type2,
            title=(b),
            ymode=log,
            title style = {text depth=0.15ex,xshift=-30ex},
            ybar = 0pt,
            xmajorgrids={false},
            ymajorgrids={false},
            xtick pos = bottom,
            ytick pos = left,
            bar width = 6pt,
            legend image code/.code={\draw [#1] (0cm,-0.1cm) rectangle (0.2cm,0.25cm);},
            legend style={%
                legend columns={-1},
                thick,
            },
            xmin=0.3,
            xmax=5.7,
            ymin={1},
            ymax={50000},
            ytick={1,100, 10000},
            xtick={1,2,3,4,5},
            xticklabels={%
                {E. coli core},
                {iAB RBC 283},
                {iIT341},
                {iSB619},
                {HepG2}
            },
            xticklabel style = {%
                rotate=45,
                anchor=north east
            },
            ylabel={Nitrogen AEFM class count (\#)},
            axis line style={thick,black},
            xtick style={/pgfplots/on layer=axis foreground, thick, black},
            ytick style={/pgfplots/on layer=axis foreground, thick, black},
            legend to name=leg,
        ]
            \addplot[black, fill=julia1]
                coordinates {
                    (1,88)
                    (2,1390)
                    (3,7548)
                    (4,10711)
                    (5,3105)
                }
                ;
            \addplot[black, fill=julia2]
                coordinates {
                    (1,3)
                    (2,0)
                    (3,269)
                    (4,291)
                    (5,55)
                }
                ;
            \addplot[black, fill=julia3]
                coordinates {
                    (1,113)
                    (2,701)
                    (3,2585)
                    (4,3157)
                    (5,1945)
                }
                ;
            \addplot[black, fill=julia5]
                coordinates {
                    (1,0)
                    (2,0)
                    (3,38)
                    (4,55)
                    (5,0)
                }
                ;

        \legend{{Src-to-sink (no revisit)\hspace*{0.35cm}}, {Src-to-sink (revisit)\hspace*{0.35cm}}, {Loop (no revisit)\hspace*{0.35cm}}, {Loop (revisit)\hspace*{0.35cm}}}
        \coordinate (c2) at (rel axis cs:1,1);

        \nextgroupplot[%
            %title=type3,
            title=(c),
            yshift=-35pt,
            title style = {text depth=0.15ex,xshift=-30ex},
            height={7cm},
            width={7cm},
            no markers,
            xlabel = Carbon AEFM length (\#),
            ylabel = {Fraction of all carbon AEFMs},
            scaled y ticks = base 10:2,
            legend cell align = {left},
            legend style={%
                thick,
            },
            xmajorgrids={false},
            ymajorgrids={false},
            xtick pos = bottom,
            ytick pos = left,
            xmax={120},
            xtick={0,30,60,90,120},
            ymax={0.15},
            axis line style={thick,black},
            xtick style={/pgfplots/on layer=axis foreground, thick, black},
            ytick style={/pgfplots/on layer=axis foreground, thick, black},
        ]
            \addplot[cred, line width=1.5pt]
                table[row sep={\\}]
                {
                    \\
                    0.0  0.0  \\
                    3.0  0.08559595029912563  \\
                    5.0  0.03612517257248044  \\
                    7.0  0.012808712992790305  \\
                    9.0  0.02024850437183617  \\
                    11.0  0.026077619266758705  \\
                    13.0  0.028531983433041877  \\
                    15.0  0.02569412486577696  \\
                    17.0  0.024313545022242675  \\
                    19.0  0.036892161374443934  \\
                    21.0  0.04149409418622488  \\
                    23.0  0.03520478601012425  \\
                    25.0  0.03014265991716521  \\
                    27.0  0.028992176714219973  \\
                    29.0  0.023163061819297438  \\
                    31.0  0.018177634606534744  \\
                    33.0  0.013805798435342844  \\
                    35.0  0.007209694738456818  \\
                    37.0  0.0032213529682466636  \\
                    39.0  0.0014572787237306336  \\
                    41.0  0.0006902899217671422  \\
                    43.0  0.00015339776039269826  \\
                    120.0  0.0  \\
                }
                ;
            \addlegendentry {E. coli core}
            \addplot[cgreen, line width=1.5pt]
                table[row sep={\\}]
                {
                    \\
                    0.0  0.0  \\
                    2.5  0.09738627795928625  \\
                    3.5  0.14501130937421464  \\
                    4.5  0.0975119376727821  \\
                    5.5  0.06886152299572756  \\
                    6.5  0.07150037697914048  \\
                    7.5  0.05064086453882885  \\
                    8.5  0.049007288263382756  \\
                    9.5  0.04222166373460669  \\
                    10.5  0.0389545111837145  \\
                    11.5  0.0446091982910279  \\
                    12.5  0.04360392058306107  \\
                    13.5  0.049509927117366175  \\
                    14.5  0.055918572505654685  \\
                    15.5  0.04234732344810254  \\
                    16.5  0.03933149032420206  \\
                    17.5  0.02877607439055039  \\
                    18.5  0.018848957024377985  \\
                    19.5  0.006785624528776075  \\
                    20.5  0.005152048253329982  \\
                    21.5  0.0030158331239004774  \\
                    22.5  0.0010052777079668257  \\
                    120.0  0.0  \\
                }
                ;
            \addlegendentry {iAB RBC 283}
            \addplot[cpurple, line width=1.5pt]
                table[row sep={\\}]
                {
                    \\
                    0.0  0.0  \\
                    3.0  0.08229686938922078  \\
                    5.0  0.0367740671824503  \\
                    7.0  0.039042862272712434  \\
                    9.0  0.04806907583325172  \\
                    11.0  0.051594685469918064  \\
                    13.0  0.0450984232690236  \\
                    15.0  0.04038128815329873  \\
                    17.0  0.034668494760552344  \\
                    19.0  0.029771814709626872  \\
                    21.0  0.02534848039695753  \\
                    23.0  0.01988052100675742  \\
                    25.0  0.015114419090523292  \\
                    27.0  0.01150719811967486  \\
                    29.0  0.007377664610061045  \\
                    31.0  0.003949988574413215  \\
                    33.0  0.0025625958933176637  \\
                    35.0  0.0019423497535337709  \\
                    37.0  0.0017464825514967519  \\
                    39.0  0.0016485489504782424  \\
                    41.0  0.000946691476512258  \\
                    43.0  0.0002448340025462736  \\
                    45.0  3.264453367283648e-5  \\
                    120.0  0.0  \\
                }
                ;
            \addlegendentry {iIT341}
            \addplot[corange, line width=1.5pt]
                table[row sep={\\}]
                {
                    \\
                    0.0  0.0  \\
                    3.0  0.057289213377296276  \\
                    5.0  0.044958280061907004  \\
                    7.0  0.04110591481057802  \\
                    9.0  0.039406836686629435  \\
                    11.0  0.03872552318148173  \\
                    13.0  0.04301527488055985  \\
                    15.0  0.04502557028463764  \\
                    17.0  0.04320873427091044  \\
                    19.0  0.03802738712065137  \\
                    21.0  0.03378810308862122  \\
                    23.0  0.02655440414507772  \\
                    25.0  0.018950608976515713  \\
                    27.0  0.01192719197900545  \\
                    29.0  0.00800753650494583  \\
                    31.0  0.005156113316735079  \\
                    33.0  0.0029607698001480384  \\
                    35.0  0.001438328510867371  \\
                    37.0  0.0004037413363838234  \\
                    39.0  5.0467667047977926e-5  \\
                    120.0  0.0  \\
                }
                ;
            \addlegendentry {iSB619}
            \addplot[cblue, line width=1.5pt]
                table[row sep={\\}]
                {
                    \\
                    0.0  0.0  \\
                    5.0  0.00042575184134002687  \\
                    15.0  0.00018669062323300832  \\
                    25.0  0.0008347652701327562  \\
                    35.0  0.002934312507538018  \\
                    45.0  0.007808217230659453  \\
                    55.0  0.016666918889321487  \\
                    65.0  0.02475606629878846  \\
                    75.0  0.023624778903913717  \\
                    85.0  0.01442837403977689  \\
                    95.0  0.006141621644922781  \\
                    105.0  0.0018889183912963923  \\
                    115.0  0.00029294514890996245  \\
                    125.0  1.0639210167049356e-5  \\
                    120.0  0.0  \\
                }
                ;
            \addlegendentry {HepG2}
        \nextgroupplot[%
            %title=type4,
            title=(d),
            yshift=-35pt,
            title style = {text depth=0.15ex,xshift=-30ex},
            no markers,
            xlabel = Nitrogen AEFM length (\#),
            ylabel = {Fraction of all nitrogen AEFMs},
            scaled y ticks = base 10:1,
            legend cell align = {left},
            xmajorgrids={false},
            ymajorgrids={false},
            xtick pos = bottom,
            ytick pos = left,
            xmax={40},
            xtick={0,10,20,30,40},
            ymax={0.6},
            extra y tick labels={10},
            extra y tick style={yticklabel style={color=white}},
            ytick={0,0.2,0.4,0.6},
            yticklabels={0,2,4,6},
            axis line style={thick,black},
            xtick style={/pgfplots/on layer=axis foreground, thick, black},
            ytick style={/pgfplots/on layer=axis foreground, thick, black},
        ]
            \addplot[cred, line width=1.5pt]
                table[row sep={\\}]
                {
                    \\
                    0.0  0.0  \\
                    2.5  0.21568627450980393  \\
                    3.5  0.44607843137254904  \\
                    4.5  0.17647058823529413  \\
                    5.5  0.15196078431372548  \\
                    6.5  0.00980392156862745  \\
                    40.0  0.0  \\
                }
                ;
            \addplot[cgreen, line width=1.5pt]
                table[row sep={\\}]
                {
                    \\
                    0.0  0.0  \\
                    2.5  0.06791009086561454  \\
                    3.5  0.12482065997130559  \\
                    4.5  0.13868962219033956  \\
                    5.5  0.10808225729316116  \\
                    6.5  0.10425633668101388  \\
                    7.5  0.07604017216642754  \\
                    8.5  0.09182209469153516  \\
                    9.5  0.0784313725490196  \\
                    10.5  0.05117168818747011  \\
                    11.5  0.043041606886657105  \\
                    12.5  0.029172644667623145  \\
                    13.5  0.018173122907699665  \\
                    14.5  0.028694404591104734  \\
                    15.5  0.02391200382592061  \\
                    16.5  0.0014347202295552368  \\
                    17.5  0.00860832137733142  \\
                    18.5  0.005738880918220947  \\
                    40.0  0.0  \\
                }
                ;
            \addplot[cpurple, line width=1.5pt]
                table[row sep={\\}]
                {
                    \\
                    0.0  0.0  \\
                    2.5  0.045095785440613025  \\
                    7.5  0.0700191570881226  \\
                    12.5  0.06093869731800766  \\
                    17.5  0.01818007662835249  \\
                    22.5  0.003984674329501916  \\
                    27.5  0.001781609195402299  \\
                    40.0  0.0  \\
                }
                ;
            \addplot[corange, line width=1.5pt]
                table[row sep={\\}]
                {
                    \\
                    0.0  0.0  \\
                    2.5  0.040453074433656956  \\
                    7.5  0.06700436189672154  \\
                    12.5  0.046883354439285214  \\
                    17.5  0.03378359364007317  \\
                    22.5  0.01129871957225271  \\
                    27.5  0.0005768960180104123  \\
                    40.0  0.0  \\
                }
                ;
            \addplot[cblue, line width=1.5pt]
                table[row sep={\\}]
                {
                    \\
                    0.0  0.0  \\
                    2.5  0.042664054848188054  \\
                    7.5  0.0602154750244858  \\
                    12.5  0.024995102840352595  \\
                    17.5  0.027580803134182173  \\
                    22.5  0.0211949069539667  \\
                    27.5  0.021077375122428993  \\
                    32.5  0.0022722820763956906  \\
                    40.0  0.0  \\
                }
                ;

        \nextgroupplot[%
            %title=type5,
            title=(e),
            title style = {text depth=0.15ex,xshift=-30ex},
            yshift=35pt,
            ytick = {0, 2, 4},
            yticklabels = {{$10^0$}, {$10^2$}, {$10^4$}},
            xtick = {1, 2, 3, 4, 5},
            xticklabels = {{E. coli core}, {iAB RBC 283}, {iIT341}, {iSB619}, {HepG2}},
            xticklabel style = {rotate=45,anchor=north east},
            ylabel = {Per source metabolite\\[0.1cm]$\bigg(\frac{\max(\text{\# Carbon AEFMs})}{\min(\text{\# Carbon AEFMs})}\bigg)$},
            ylabel style = {align=center},
            ymin=-1.0,
            ymax=5,
            xmin=0.5,
            xmax=5.5,
            xtick pos = bottom,
            ytick pos = left,
            legend pos=outer north east,
            legend cell align=left,
            axis line style={thick,black},
            xtick style={/pgfplots/on layer=axis foreground, thick, black},
            ytick style={/pgfplots/on layer=axis foreground, thick, black},
        ]
            \addplot [%
                scatter,
                only marks,
                scatter src=explicit symbolic,
                mark size=2.0pt,
                scatter/classes={%
                    1={mark=*,draw=black,fill=cred},
                    2={mark=*,draw=black,fill=cgreen},
                    3={mark=*,draw=black,fill=cpurple},
                    4={mark=*,draw=black,fill=corange},
                    5={mark=*,draw=black,fill=cblue}
                }
            ] table[x=z, y=y, meta=x]{subpanel-e-f/figure-jitter-max-over-min-log10-number-efms-carbon.dat};

            % Manual labels of interest
            \node[pinnode] at (axis cs: 4.96, 4.8) (phenylalanine) {Phenylalanine$^*$};
            \draw[line width=0.5pt] (axis cs: 4.957381805439622, 4.346529004101864) -- (phenylalanine);
            \node[pinnode] at (axis cs: 4.99, 4.0) (methionine) {Methionine$^*$};
            \draw[line width=0.5pt] (axis cs: 4.993905929728252, 3.5541412255633693) -- (methionine);
            \node[pinnode] at (axis cs: 5.07, 3.3) (histidine) {Histidine$^*$};
            \draw[line width=0.5pt] (axis cs: 5.071390810847966, 2.9151417734446867) -- (histidine);
            \node[pinnode] at (axis cs: 4.5, 2.567) (isoleucine) {Isoleucine};
            \draw[line width=0.5pt] (axis cs: 3.1434101080157903, 0.0) -- (isoleucine);
            \draw[line width=0.5pt] (axis cs: 4.064330751774216, 1.0511525224473812) -- (isoleucine);
            \draw[line width=0.5pt] (axis cs: 5.078888241522378, 1.7883044932582974) -- (isoleucine);

            \node[pinnode] at (axis cs: 2.7, 4.3) (cholesta) {4,4-dimethyl-14alpha-formyl-5alpha-cholesta-8-en-3beta-ol};
            \draw[line width=0.5pt] (axis cs: 5.153059368017448, 2.4099331233312946) -- (cholesta);

            \node[pinnode] at (axis cs: 3.5, -0.5) (glycine) {Glycine};
            \draw[line width=0.5pt] (axis cs: 1.801291611283892, 0) -- (glycine);
            \draw[line width=0.5pt] (axis cs: 2.920326842878735, 0) -- (glycine);
            \draw[line width=0.5pt] (axis cs: 4.047488634997549, 0) -- (glycine);
            \draw[line width=0.5pt] (axis cs: 5.183617418150977, 0) -- (glycine);

            \node[pinnode] at (axis cs: 3.3, 3.0) (gps) {Glycerophosphoserine};
            \draw[line width=0.5pt] (axis cs: 3.9440850149833575, 1.9678153166285988) -- (gps);

            \node[pinnode] at (axis cs: 1.75, 0.885) (AKG) {AKG$^*$};
            \draw[line width=0.5pt] (axis cs: 1.0910430651498462, 0.8450980400142568) -- (AKG);

            \node[pinnode] at (axis cs: 2.0, 3.5) (nadmla) {N-Acetyl-D-muramoyl-L-alanine};
            \draw[line width=0.5pt] (axis cs: 2.931550262336178, 2.2121876044039577) -- (nadmla);

            \node[pinnode] at (axis cs: 1.93, 1.4) (salh) {S-Adenoyl-L-homocysteine};
            \draw[line width=0.5pt] (axis cs: 2.083433115238802, 2.093421685162235) -- (salh);
            \draw[line width=0.5pt] (axis cs: 3.038998707332242, 1.7745169657285496) -- (salh);

            \node[pinnode] at (axis cs: 1.666, 2.6) (o5p) {Orotidine 5'-phosphate};
            \draw[line width=0.5pt] (axis cs: 1.8347998076283822, 1.6020599913279623) -- (o5p);
            \draw[line width=0.5pt] (axis cs: 3.032171320288804, 1.766818287765997) -- (o5p);
            \draw[line width=0.5pt] (axis cs: 4.059128136291379, 1.6014881749426513) -- (o5p);

        \nextgroupplot[%
            %title=type6,
            title=(f),
            title style = {text depth=0.15ex,xshift=-30ex},
            yshift=35pt,
            ytick = {0, 1, 2},
            yticklabels = {{$10^0$}, {$10^1$}, {$10^2$}},
            xtick  = {1, 2, 3, 4, 5},
            xticklabels={%
                {E. coli core},
                {iAB RBC 283},
                {iIT341},
                {iSB619},
                {HepG2}
            },
            xticklabel style = {rotate=45,anchor=north east},
            ylabel = {Per source metabolite\\[0.1cm]$\bigg(\frac{\max(\text{\# Nitrogen AEFMs})}{\min(\text{\# Nitrogen AEFMs})}\bigg)$},
            ylabel style = {align=center},
            ymin=-0.5,
            xmin=0.5,
            xmax=5.5,
            xtick pos = bottom,
            ytick pos = left,
            legend pos=outer north east,
            legend cell align=left,
            axis line style={thick,black},
            xtick style={/pgfplots/on layer=axis foreground, thick, black},
            ytick style={/pgfplots/on layer=axis foreground, thick, black},
        ]
            \addplot [%
                scatter,
                only marks,
                scatter src=explicit symbolic,
                mark size=2.0pt,
                scatter/classes={%
                    1={mark=*,draw=black,fill=cred},
                    2={mark=*,draw=black,fill=cgreen},
                    3={mark=*,draw=black,fill=cpurple},
                    4={mark=*,draw=black,fill=corange},
                    5={mark=*,draw=black,fill=cblue}
                }
            ] table[x=z, y=y, meta=x]{subpanel-e-f/figure-jitter-max-over-min-log10-number-efms-nitrogen.dat};

            % Manual labels of interest
            \node[pinnode] at (axis cs: 4.07, 2.190) (histidine) {Histidine$^*$};
            \draw[line width=0.5pt] (axis cs: 4.068617173646408, 1.8409420802430991) -- (histidine);
            \draw[line width=0.5pt] (axis cs: 4.997907677633833, 2.1903316981702914) -- (histidine);

            \node[pinnode] at (axis cs: 5.08, 1.7) (arginine) {Arginine$^*$};
            \draw[line width=0.5pt] (axis cs: 5.088545227484431, 2.037426497940624) -- (arginine);

            \node[pinnode] at (axis cs: 1.75, 1.4) (sah) {S-adenosylhomocysteine$^*$};
            \draw[line width=0.5pt] (axis cs: 2.07545551765406, 1.8325089127062364) -- (sah);
            \draw[line width=0.5pt] (axis cs: 3.025340261489189, 1.6180480967120927) -- (sah);

            \node[pinnode] at (axis cs: 2., 2.190) (nac) {N-acetylmuramoylalanine$^*$};
            \draw[line width=0.5pt] (axis cs: 3.0654980224359236, 1.7708520116421442) -- (nac);

            \node[pinnode] at (axis cs: 3.6, 1.0) (nsl) {N-Succinyl-LL-2,6-diaminoheptanedioate};
            \draw[line width=0.5pt] (axis cs: 2.9315217241518337, 1.6782147827453993) -- (nsl);
            \draw[line width=0.5pt] (axis cs: 3.8655526905952637, 1.7263196121107753) -- (nsl);

        \end{groupplot}

        % Bar plot legend programmatically centered.
        \coordinate (c3) at ($(c1)!0.5!(c2)$);
        \node[below,yshift=-7.5cm] at (c3)
        {\pgfplotslegendfromname{leg}};

    \end{tikzpicture}

\end{document}

